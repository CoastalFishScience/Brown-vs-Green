---
title: "Sturges_Brown_Green_Code"
author: "James Sturges"
date: "2023-06-22"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Librarys Used
```{r, include=FALSE, warning = FALSE}
library(MixSIAR)
library(forcats)
library(car)
library(scales)
library(rgl)
library(magick)
library(R2jags)
library(rjags)
library(tidyverse)
library(dplyr)
```

#### DATASETUP ----



Raw Stable Isotope Data provided by University of Louisianna Lafayette with summary
```{r}
SI <- read.csv("SI_data_csv_8_30_21.csv",na.strings=c("","NA"))%>%filter(is.na(outlier))

summary(SI)
```

Stable Isotope Data Summarization and Filtering of SI Dataset: Grouping, Averaging, and Filtering of Variables
```{r}
SIa<-SI %>% group_by(site,season,group, common_name, functional_grp) %>% 
  summarise(n=n(),md13C = mean(as.numeric(d13C), na.rm = T),d13Csd=sd(as.numeric(d13C),na.rm = T),
                  md15N=mean(as.numeric(d15N),na.rm = T),d15Nsd=sd(as.numeric(d15N),na.rm = T),
            md34S=mean(as.numeric(d34S),na.rm = T),d34Ssd=sd(d34S,na.rm = T)) %>%
filter(!is.na(md13C),!is.na(md15N),!is.na(md34S))


SIb<-SI %>% group_by(site,group, common_name, functional_grp) %>% 
  summarise(n=n(),md13C = mean(d13C,na.rm = T),d13Csd=sd(d13C,na.rm = T), md15N=mean(d15N,na.rm = T),d15Nsd=sd(d15N,na.rm = T),md34S=mean(d34S,na.rm = T),d34Ssd=sd(d34S,na.rm = T))  %>%
  filter(!is.na(md13C),!is.na(md15N),!is.na(md34S))
```


#### SRS3 Biplots ----
```{r}
SRS3<-SIa %>% filter(site == 'SRS3', common_name!="Egyptian paspalidium")


SRS3CSbiplot<-ggplot(SRS3,aes(x = md13C,y = md34S )) +            #coord_fixed(ratio = 1)+
  geom_errorbarh(data = SRS3,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = SRS3,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=SRS3, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=3,check_overlap = T)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+
scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


SRS3CNbiplot<-ggplot(SRS3,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = SRS3,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = SRS3,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=SRS3, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name), size =3, check_overlap = T)+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)

```



#### Florida Bay Sites ----


#### TS3 ----
```{r}
TS3<-SIa %>% filter(site == 'TS3', common_name!="Egyptian paspalidium")


TS3CSbiplot<-ggplot(TS3,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS3,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS3,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS3, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = F)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


TS3CNbiplot<-ggplot(TS3,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS3,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS3,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS3, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name))+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()

```


#### RB10 ----
```{r}
RB10<-SIa %>% filter(site == 'RB10', common_name!="Egyptian paspalidium")


RB10CSbiplot<-ggplot(RB10,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = RB10,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = RB10,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=RB10, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = T)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


RB10CNbiplot<-ggplot(RB10,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = RB10,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = RB10,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=RB10, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name),check_overlap = T)+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()

```


#### SRS 4 ----
```{r}
SRS4<-SIa %>% filter(site == 'SRS4', common_name!="Egyptian paspalidium")


SRS4CSbiplot<-ggplot(SRS4,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = SRS4,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = SRS4,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=SRS4, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = F)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


SRS4CNbiplot<-ggplot(SRS4,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = SRS4,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = SRS4,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=SRS4, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name))+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()
```


#### SRS6 ----
```{r}
SRS6<-SIa %>% filter(site == 'SRS6', common_name!="Egyptian paspalidium")


SRS6CSbiplot<-ggplot(SRS6,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = SRS6,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = SRS6,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=SRS6, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = F)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


SRS6CNbiplot<-ggplot(SRS6,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = SRS6,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = SRS6,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=SRS6, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name))+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()
```


#### TS7 ----
```{r}
TS7<-SIa %>% filter(site == 'TS7', common_name!="Egyptian paspalidium")


TS7CSbiplot<-ggplot(TS7,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS7,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS7,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS7, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = F)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


TS7CNbiplot<-ggplot(TS7,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS7,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS7,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS7, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name))+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()
```

#### TS9 ----
```{r}
TS9<-SIa %>% filter(site == 'TS9', common_name!="Egyptian paspalidium")


TS9CSbiplot<-ggplot(TS9,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS9,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS9,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS9, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = F)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


TS9CNbiplot<-ggplot(TS9,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS9,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS9,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS9, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name))+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()
```

#### TS10 ----
```{r}
TS10<-SIa %>% filter(site == 'TS10')


TS10CSbiplot<-ggplot(TS10,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS10,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS10,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS10, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = T)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


TS10CNbiplot<-ggplot(TS10,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS10,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS10,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS10, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name))+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()
```

#### TS11 ----
```{r}
TS11<-SIa %>% filter(site == 'TS11')


TS11CSbiplot<-ggplot(TS11,aes(x = md13C,y = md34S )) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS11,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS11,aes(ymin = md34S - d34Ssd,ymax = md34S + d34Ssd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS11, aes(color=functional_grp),size=2)+ geom_text(aes(label = common_name),size=4,check_overlap = F)+#scale_shape_manual(values=c(1,0,15,16,2))+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6)) + facet_wrap(~season,nrow=2)+scale_color_viridis_d()


TS11CNbiplot<-ggplot(TS11,aes(x = md13C,y = md15N)) +#coord_fixed(ratio = 1)+
  geom_errorbarh(data = TS11,aes(xmin = md13C - d13Csd ,xmax = md13C + d13Csd), height=0 ,color="#999999") + 
  geom_errorbar(data = TS11,aes(ymin = md15N - d15Nsd,ymax = md15N + d15Nsd),width=0,color="#999999")+ theme_bw()+
  geom_point(data=TS11, aes(color=functional_grp),size=2)+scale_shape_manual(values=c(1,0,15,16,2))+
  geom_text(aes(label = common_name))+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+theme(text = element_text(size=12))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+ facet_wrap(~season,nrow=2)+scale_color_viridis_d()
```

#### Site Re-leved ----
```{r}
SIa$site<-fct_relevel(SIa$site, "SRS3","RB10", "SRS4","SRS6","TS3","TS7","TS9","TS10","TS11")
```

#### Generates a scatter plot to visualize the relationship between carbon (δ¹³C) and sulfur (δ³⁴S) isotopes in across source groups.  ----
```{r}
SIa1<-SIa%>% filter(group != 'Source')
transectCS<-ggplot(SIa1,aes(x = md13C,y = md34S ))+
  theme_bw()+
  geom_point(data=SIa1, aes(color=group),size=2)+
  ylab(expression(paste(delta^{34}, "S (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  facet_wrap(season~site,nrow=2)+scale_color_viridis_d()
```

#### Generates a 
```{r}
transectCN<-ggplot(SIa1,aes(x = md13C,y = md15N ))+
  theme_bw()+
  geom_point(data=SIa1, aes(color=group),size=2)+
  ylab(expression(paste(delta^{15}, "N (\u2030)")))+
  xlab(expression(paste(delta^{13}, "C (\u2030)")))+
  theme(text = element_text(size=14))+scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  facet_wrap(season~site,nrow=2)+scale_color_viridis_d()

transectCN
```

#### Mixing Models ----

#### TS3 ----
```{r}
TS3mix<-SIa %>% filter(site == 'TS3', common_name!="Egyptian paspalidium",group=='Consumer')%>% rename('d13C'='md13C',"d15N"= "md15N","d34S"="md34S")


write.csv(TS3mix,"TS3mix.csv",row.names = F) 

mix <- load_mix_data(filename="TS3mix.csv",
                     iso_names=c("d13C","d15N","d34S"),
                     factors='season',
                     fac_random=F,
                     fac_nested=F,
                     cont_effects=NULL)

source <- load_source_data(filename="sourcesTS3.csv",
                           source_factors=NULL,
                           conc_dep=FALSE,
                           data_type="means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_TS3.csv"), mix)

plot_data(filename="TS3_isospace_plot", plot_save_pdf=T, plot_save_png=T, mix,source,discr)

model_filename <- "TS3_mix.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)

```

#### test model ----
```{r}
jags.TS3 <- run_model(run="test", mix, source, discr, model_filename, 
                             alpha.prior = 1, resid_err=F, process_err=T)
```

#### normal model ----
```{r}
jags.TS3 <- run_model(run="normal", mix, source, discr, model_filename,
                             alpha.prior = 1, resid_err=F, process_err=T)
```

#### jags output ---- 
```{r}
output_jags.TS3  <- list(summary_save = TRUE,
                                  summary_name = "FCETS3_sumstats",
                                  sup_post = FALSE,
                                  plot_post_save_pdf = F,
                                  plot_post_name = "FCETS3_plot",
                                  sup_pairs = FALSE,
                                  plot_pairs_save_pdf = F,
                                  plot_pairs_name = "FCETS3_pairs",
                                  sup_xy = T,
                                  plot_xy_save_pdf = F,
                                  plot_xy_name = "FCETS3_plot",
                                  gelman = TRUE,
                                  heidel = FALSE,
                                  geweke = T,
                                  diag_save = F,
                                  diag_name = "FCETS3_Diagnostic",
                                  indiv_effect = FALSE,
                                  plot_post_save_png = F,
                                  plot_pairs_save_png = FALSE,
                                  plot_xy_save_png = F)

output_JAGS(jags.TS3 , mix, source, output_jags.TS3)
```

#### combined posterior brown vs green ----

```{r}
combinedTS3 <- combine_sources(jags.TS3, mix, source, alpha.prior=1, 
                            groups=list(green=c('Periphyton'), brown=c('Plant', 'Floc' )))

# get posterior medians for new source groupings
apply(combinedTS3$post, 2, median)
summary_stat(combinedTS3, meanSD=FALSE, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
             filename = "TS3_combined_sumstats" )
```


#### SRS4 ---- 

```{r}
SRS4mix<-SIa %>% filter(site == 'SRS4', common_name!="Egyptian paspalidium",group=='Consumer')%>% rename('d13C'='md13C',"d15N"= "md15N","d34S"="md34S")


write.csv(SRS4mix,"SRS4mix.csv",row.names = F) 

mix <- load_mix_data(filename="SRS4mix.csv",
                     iso_names=c("d13C","d15N","d34S"),
                     factors='season',
                     fac_random=F,
                     fac_nested=F,
                     cont_effects=NULL)

source <- load_source_data(filename="sources_SRS4.csv",
                           source_factors=NULL,
                           conc_dep=FALSE,
                           data_type="means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_SRS4.csv"), mix)

plot_data(filename="SRS4_isospace_plot", plot_save_pdf=T, plot_save_png=T, mix,source,discr)

model_filename <- "SRS4_mix.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)

```

#### run test model ----
```{r}
#run a test model to make sure it works
jags.SRS4 <- run_model(run="test", mix, source, discr, model_filename, 
                      alpha.prior = 1, resid_err=F, process_err=T)
```

#### run normal model ---
```{r}
jags.SRS4 <- run_model(run="normal", mix, source, discr, model_filename,
                      alpha.prior = 1, resid_err=F, process_err=T)

```
#### output jags ----
```{r}
output_jags.SRS4  <- list(summary_save = TRUE,
                         summary_name = "FCESRS4_sumstats",
                         sup_post = FALSE,
                         plot_post_save_pdf = F,
                         plot_post_name = "FCESRS4_plot",
                         sup_pairs = FALSE,
                         plot_pairs_save_pdf = F,
                         plot_pairs_name = "FCESRS4_pairs",
                         sup_xy = T,
                         plot_xy_save_pdf = F,
                         plot_xy_name = "FCESRS4_plot",
                         gelman = TRUE,
                         heidel = FALSE,
                         geweke = T,
                         diag_save = F,
                         diag_name = "FCESRS4_Diagnostic",
                         indiv_effect = FALSE,
                         plot_post_save_png = F,
                         plot_pairs_save_png = FALSE,
                         plot_xy_save_png = F)

output_JAGS(jags.SRS4 , mix, source, output_jags.SRS4)
```

#### combined posterior ----
```{r}
combinedSRS4 <- combine_sources(jags.SRS4, mix, source, alpha.prior=1, 
                               groups=list(green=c('SPOM',"Epiphytic microalgae"), brown=c('Peat')))

# get posterior medians for new source groupings
apply(combinedSRS4$post, 2, median)
summary_stat(combinedSRS4, meanSD=FALSE, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
             filename = "SRS4_combined_sumstats" )
```


#### TSFB Transect ----

```{r}
TSFBmix<-SIa %>% filter(site == 'TS7'|site =='TS9'|site =='TS10'|site =='TS11', common_name!="Egyptian paspalidium",group=='Consumer')%>% rename('d13C'='md13C',"d15N"= "md15N","d34S"="md34S")


write.csv(TSFBmix,"TSFBmix.csv",row.names = F) 

mix <- load_mix_data(filename="TSFBmix.csv",
                     iso_names=c("d13C","d15N","d34S"),
                     factors='season',
                     fac_random=F,
                     fac_nested=F,
                     cont_effects=NULL)

source <- load_source_data(filename="FCE_sources_TSFB.csv",
                           source_factors=NULL,
                           conc_dep=FALSE,
                           data_type="means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_TSFB.csv"), mix)

plot_data(filename="TSFB_isospace_plot", plot_save_pdf=T, plot_save_png=T, mix,source,discr)


model_filename <- "TSFB_mix.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)


```
#### run test model ----
```{r}
jags.TSFB <- run_model(run="test", mix, source, discr, model_filename, 
                       alpha.prior = 1, resid_err=F, process_err=T)

```
#### run normal model ----
```{r}

jags.TSFB <- run_model(run="long", mix, source, discr, model_filename,
                       alpha.prior = 1, resid_err=F, process_err=T)

```
#### output jags ----
```{r}
output_jags.TSFB  <- list(summary_save = TRUE,
                          summary_name = "FCETSFB_sumstats",
                          sup_post = FALSE,
                          plot_post_save_pdf = F,
                          plot_post_name = "FCETSFB_plot",
                          sup_pairs = FALSE,
                          plot_pairs_save_pdf = F,
                          plot_pairs_name = "FCETSFB_pairs",
                          sup_xy = T,
                          plot_xy_save_pdf = F,
                          plot_xy_name = "FCETSFB_plot",
                          gelman = TRUE,
                          heidel = FALSE,
                          geweke = T,
                          diag_save = F,
                          diag_name = "FCETSFB_Diagnostic",
                          indiv_effect = FALSE,
                          plot_post_save_png = F,
                          plot_pairs_save_png = FALSE,
                          plot_xy_save_png = F)

output_JAGS(jags.TSFB , mix, source, output_jags.TSFB)


```
#### combined posterior  ----
```{r}

combinedTSFB <- combine_sources(jags.TSFB, mix, source, alpha.prior=1, 
                                groups=list(green=c('Epiphytic microalgae','SPOM' ), brown=c('Seagrass', 'Red Mangrove')))

# get posterior medians for new source groupings
apply(combinedTSFB$post, 2, median)
summary_stat(combinedTSFB, meanSD=FALSE, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
             filename = "TSFB_combined_sumstats" )


#               2.5%   25%   50%   75% 97.5%
#p.green.dry19 0.562 0.684 0.751 0.823 0.926
#p.brown.dry19 0.074 0.177 0.249 0.316 0.438
#p.green.wet19 0.630 0.755 0.818 0.880 0.974
#p.brown.wet19 0.026 0.120 0.182 0.245 0.370
```
#### SRS Transect ---- 
```{r}
SRS6mix <- SIa %>% filter(site == 'SRS6', group == 'Consumer') %>% rename(d13C = md13C, d15N = md15N, d34S = md34S)

write.csv(SRS6mix, "SRS6mix.csv", row.names = FALSE)

mix <- load_mix_data(filename = "SRS6mix.csv",
                     iso_names = c("d13C", "d15N", "d34S"),
                     factors = 'season',
                     fac_random = FALSE,
                     fac_nested = FALSE,
                     cont_effects = NULL)

source <- load_source_data(filename = "sourcesSRS6_2.csv",
                           source_factors = NULL,
                           conc_dep = FALSE,
                           data_type = "means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_SRS6_1.csv"), mix)

#plot_data(filename = "SRS6_isospace_plot", plot_save_pdf = TRUE, plot_save_png = TRUE, mix, source, discr)

model_filename <- "SRS6_mix.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)

```
#### run test model---- 
```{r}
jags.SRS6 <- run_model(run="test", mix, source, discr, model_filename, 
                      alpha.prior = 1, resid_err=F, process_err=T)

```
#### run normal model---- 
```{r}
jags.SRS6 <- run_model(run="normal", mix, source, discr, model_filename,
                      alpha.prior = 1, resid_err=F, process_err=T)
```
#### output jags ---- 
```{r}
output_jags.SRS6  <- list(summary_save = TRUE,
                         summary_name = "FCESRS6_sumstats",
                         sup_post = FALSE,
                         plot_post_save_pdf = F,
                         plot_post_name = "FCESRS6_plot",
                         sup_pairs = FALSE,
                         plot_pairs_save_pdf = F,
                         plot_pairs_name = "FCESRS6_pairs",
                         sup_xy = T,
                         plot_xy_save_pdf = F,
                         plot_xy_name = "FCESRS6_plot",
                         gelman = TRUE,
                         heidel = FALSE,
                         geweke = T,
                         diag_save = F,
                         diag_name = "FCESRS6_Diagnostic",
                         indiv_effect = FALSE,
                         plot_post_save_png = F,
                         plot_pairs_save_png = FALSE,
                         plot_xy_save_png = F)

output_JAGS(jags.SRS6 , mix, source, output_jags.SRS6)
```
#### combined posterior ---- 
```{r}
combinedSRS6 <- combine_sources(jags.SRS6, mix, source, alpha.prior=1, 
                               groups=list(green=c('Phytoplankton','Macroalgae' ), brown=c('Mangrove')))

apply(combinedSRS6$post, 2, median)
summary_stat(combinedSRS6, meanSD=T, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
             filename = "SRS6_combined_sumstats" )
```

#### SRS4 ----
```{r}
SRS4mix<-SIa %>% filter(site == 'SRS4', common_name!="Egyptian paspalidium",group=='Consumer')%>% rename('d13C'='md13C',"d15N"= "md15N","d34S"="md34S")


write.csv(SRS4mix,"SRS4mix.csv",row.names = F) 

mix <- load_mix_data(filename="SRS4mix.csv",
                     iso_names=c("d13C","d15N","d34S"),
                     factors='season',
                     fac_random=F,
                     fac_nested=F,
                     cont_effects=NULL)

source <- load_source_data(filename="sourcesSRS4_2.csv",
                           source_factors=NULL,
                           conc_dep=FALSE,
                           data_type="means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_SRS4_2.csv"), mix)

plot_data(filename="SRS4_isospace_plot", plot_save_pdf=FALSE, plot_save_png=F, mix,source,discr)

model_filename <- "SRS4_mix_test.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)


#run a test model to make sure it works
jags.SRS4 <- run_model(run="test", mix, source, discr, model_filename, 
                       alpha.prior = 1, resid_err=F, process_err=T)


jags.SRS4 <- run_model(run="short", mix, source, discr, model_filename,
                       alpha.prior = 1, resid_err=F, process_err=T)


output_jags.SRS4  <- list(summary_save = TRUE,
                          summary_name = "FCESRS4_sumstats_demo",
                          sup_post = FALSE,
                          plot_post_save_pdf = F,
                          plot_post_name = "FCESRS4_plot_demo",
                          sup_pairs = FALSE,
                          plot_pairs_save_pdf = F,
                          plot_pairs_name = "FCESRS4_pairs_demo",
                          sup_xy = T,
                          plot_xy_save_pdf = F,
                          plot_xy_name = "FCESRS4_plot_demo",
                          gelman = TRUE,
                          heidel = FALSE,
                          geweke = T,
                          diag_save = F,
                          diag_name = "FCESRS4_Diagnostic_demo",
                          indiv_effect = FALSE,
                          plot_post_save_png = F,
                          plot_pairs_save_png = FALSE,
                          plot_xy_save_png = F)

output_JAGS(jags.SRS4 , mix, source, output_jags.SRS4)

##combine posterior ground into brown/green

#                             
#                             Mean    SD  2.5%    5%   25%   50%   75%   95% 97.5%
#p.dry19.Epiphytic microalgae 0.536 0.150 0.256 0.288 0.431 0.534 0.639 0.786 0.844
#p.wet19.Epiphytic microalgae 0.474 0.181 0.186 0.216 0.334 0.455 0.592 0.817 0.884
#p.dry19.Mangrove             0.281 0.094 0.076 0.108 0.220 0.287 0.350 0.420 0.443
#p.wet19.Mangrove             0.299 0.098 0.045 0.096 0.247 0.316 0.371 0.423 0.442
#p.dry19.Phytoplankton        0.183 0.092 0.026 0.038 0.113 0.179 0.245 0.341 0.370
#p.wet19.Phytoplankton        0.228 0.112 0.014 0.031 0.146 0.236 0.313 0.399 0.420

combinedSRS4 <- combine_sources(jags.SRS4, mix, source, alpha.prior=1, 
                                groups=list(green=c('Phytoplankton',"Epiphytic microalgae"), brown=c('Mangrove')))

# get posterior medians for new source groupings
apply(combinedSRS4$post, 2, median)
summary_stat(combinedSRS4, meanSD=T, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
             filename = "SRS4_combined_sumstats_demo" )

```

#### RB10 ----
```{r}
RB10mix<-SIa %>% filter(site == 'RB10', common_name!="Egyptian paspalidium",group=='Consumer')%>% rename('d13C'='md13C',"d15N"= "md15N","d34S"="md34S")


write.csv(RB10mix,"RB10mix.csv",row.names = F) 

mix <- load_mix_data(filename="RB10mix.csv",
                     iso_names=c("d13C","d15N","d34S"),
                     factors='season',
                     fac_random=F,
                     fac_nested=F,
                     cont_effects=NULL)

source <- load_source_data(filename="sources_RB10_1.csv",
                           source_factors=NULL,
                           conc_dep=FALSE,
                           data_type="means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_RB10_1.csv"), mix)

plot_data(filename="RB10_isospace_plot", plot_save_pdf=FALSE, plot_save_png=F, mix,source,discr)

model_filename <- "RB10_mix.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)


#run a test model to make sure it works
jags.RB10 <- run_model(run="test", mix, source, discr, model_filename, 
                       alpha.prior = 1, resid_err=F, process_err=T)


jags.RB10 <- run_model(run="normal", mix, source, discr, model_filename,
                       alpha.prior = 1, resid_err=F, process_err=T)

output_jags.RB10  <- list(summary_save = TRUE,
                          summary_name = "FCERB10_sumstats",
                          sup_post = FALSE,
                          plot_post_save_pdf = F,
                          plot_post_name = "FCERB10_plot",
                          sup_pairs = FALSE,
                          plot_pairs_save_pdf = F,
                          plot_pairs_name = "FCERB10_pairs",
                          sup_xy = T,
                          plot_xy_save_pdf = F,
                          plot_xy_name = "FCERB10_plot",
                          gelman = TRUE,
                          heidel = FALSE,
                          geweke = T,
                          diag_save = F,
                          diag_name = "FCERB10_Diagnostic",
                          indiv_effect = FALSE,
                          plot_post_save_png = F,
                          plot_pairs_save_png = FALSE,
                          plot_xy_save_png = F)

output_JAGS(jags.RB10 , mix, source, output_jags.RB10)

     #                         Mean    SD  2.5%    5%   25%   50%   75%   95% 97.5%
#p.dry19.Epiphytic microalgae 0.845 0.066 0.703 0.730 0.801 0.851 0.894 0.946 0.957
#p.wet19.Epiphytic microalgae 0.694 0.071 0.564 0.582 0.647 0.690 0.739 0.816 0.842
#p.dry19.Mangrove             0.018 0.017 0.001 0.001 0.006 0.013 0.026 0.053 0.064
#p.wet19.Mangrove             0.025 0.025 0.000 0.001 0.006 0.016 0.036 0.077 0.092
#p.dry19.Phytoplankton        0.137 0.065 0.032 0.040 0.089 0.131 0.179 0.254 0.277
#p.wet19.Phytoplankton        0.281 0.071 0.134 0.162 0.236 0.284 0.331 0.390 0.412
                              
                              
                          



# combinedRB10 <- combine_sources(jags.RB10, mix, source, alpha.prior = 1,
#                                 groups = list(green = c("Phytoplankton", "Epiphytic microalgae"),
#                                               brown = c("Mangrove")))




# get posterior medians for new source groupings
# apply(combinedRB10$post, 2, median)
# summary_stat(combinedRB10, meanSD=T, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
#              filename = "RB10_combined_sumstats" )


#             Mean    SD  2.5%   25%   50%   75% 97.5%
#p.green.dry19 0.982 0.017 0.936 0.974 0.987 0.994 0.999
#p.brown.dry19 0.018 0.017 0.001 0.006 0.013 0.026 0.064
#p.green.wet19 0.975 0.025 0.908 0.964 0.984 0.994 1.000
#p.brown.wet19 0.025 0.025 0.000 0.006 0.016 0.036 0.092
```

#### SRS3 ----
```{r}
SRS3mix<-SI %>% filter(site == 'SRS3', common_name!="Egyptian paspalidium",group=='Consumer')
# %>% rename('d13C'='md13C',"d15N"= "md15N","d34S"="md34S")


write.csv(SRS3mix,"SRS3mix.csv",row.names = F) 

mix <- load_mix_data(filename="SRS3mix.csv",
                     iso_names=c("d13C","d15N","d34S"),
                     factors=c('season','common_name'),
                     fac_random=c(F,F),
                     fac_nested=c(F,F),
                     cont_effects=NULL)

source <- load_source_data(filename="sourcesSRS3_1.csv",
                           source_factors=NULL,
                           conc_dep=FALSE,
                           data_type="means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_SRS3_1.csv"), mix)

plot_data(filename="SRS3_isospace_plot", plot_save_pdf=FALSE, plot_save_png=F, mix,source,discr)

model_filename <- "SRS3_mix.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)


#run a test model to make sure it works
jags.SRS3 <- run_model(run="test", mix, source, discr, model_filename, 
                       alpha.prior = 1, resid_err=F, process_err=T)


jags.SRS3 <- run_model(run="normal", mix, source, discr, model_filename,
                       alpha.prior = 1, resid_err=F, process_err=T)

output_jags.SRS3  <- list(summary_save = TRUE,
                          summary_name = "FCESRS3_sumstats",
                          sup_post = FALSE,
                          plot_post_save_pdf = F,
                          plot_post_name = "FCESRS3_plot",
                          sup_pairs = FALSE,
                          plot_pairs_save_pdf = F,
                          plot_pairs_name = "FCESRS3_pairs",
                          sup_xy = F,
                          plot_xy_save_pdf = F,
                          plot_xy_name = "FCESRS3_plot",
                          gelman = TRUE,
                          heidel = FALSE,
                          geweke = F,
                          diag_save = F,
                          diag_name = "FCESRS3_Diagnostic",
                          indiv_effect = FALSE,
                          plot_post_save_png = F,
                          plot_pairs_save_png = FALSE,
                          plot_xy_save_png = F)

output_JAGS(jags.SRS3 , mix, source, output_jags.SRS3)


##combine posterior ground into brown/green

jags.SRS3$BUGSoutput$sims.list$ilr.fac1



mixTable = function(file,type,ind = F,nest = F, csv = F){
  require(tidyverse)
  cn = c('ID', 'Mean', 'SD', '2.5%', '5%', '25%', '50%', '75%', '95%', '97.5%')
  if(csv){
    x = read_csv(file)
  }else{
    x = read_fwf(file, skip = 8)
  }
  names(x) = cn
  x$source = NA
  x$name = NA
  x$code = NA
  
  
  
  if (nest == F){
    for (i in 1:nrow(x)){
      temp = strsplit(x$ID, split = '.', fixed = T)
      x$source[i] = temp[[i]][3]
      x$name[i] = temp[[i]][2]
      
      x$type = type
      x$ymax = x$`75%` + 1.5*(x$`75%` - x$`25%`)
      x$ymin = x$`25%` - 1.5*(x$`75%` - x$`25%`)
      
      df = tibble(x$name, x$type, x$source, x$Mean, x$SD, x$`2.5%`, x$`97.5%`,
                  x$`50%`, x$`25%`, x$`75%`, x$ymax, x$ymin)
      colnames(df) = c('name', 'type', 'source', 'mean', 'sd', 'lowend', 'highend',
                       'mid', 'low', 'up', 'ymax', 'ymin')
    }
  }else{
    for (i in 1:nrow(x)){
      temp = strsplit(x$ID, split = '.', fixed = T)
      x$source[i] = temp[[i]][4]
      x$code[i] = temp[[i]][3]
      x$name[i] = temp[[i]][2]
      
      x$type = type
      x$ymax = x$`75%` + 1.5*(x$`75%` - x$`25%`)
      x$ymin = x$`25%` - 1.5*(x$`75%` - x$`25%`)
      
      df = tibble(x$name, x$type, x$source, x$code, x$Mean, x$SD, x$`2.5%`, x$`97.5%`,
                  x$`50%`, x$`25%`, x$`75%`, x$ymax, x$ymin)
      colnames(df) = c('name', 'type', 'source', 'code', 'mean', 'sd', 'lowend', 'highend',
                       'mid', 'low', 'up', 'ymax', 'ymin')
    }
  }
  
  for (i in 1:nrow(df)){
    if (df$ymax[i] > df$highend[i]){
      df$ymax[i] = df$highend[i]
    }
    if (df$ymin[i] < df$lowend[i]){
      df$ymin[i] = df$lowend[i]
    }
  }
  df = df %>% drop_na %>%
    filter(name != 'global')
  
  
  if (ind == T){
    if (nest == T){
      df = df %>% select(name, type, code, source, mean) %>%
        pivot_wider(names_from = 'source', values_from = 'mean')
    }else{
      df = df %>% select(name, type, source, mean)%>%
        pivot_wider(names_from = 'source', values_from = 'mean')
    }
  }
  
  return(df)
}

df_srs3 = mixTable("FCESRS3_sumstats.txt", type = "SRS3", ind = F, nest = T)


options(max.print = 6000000)




# fact1 = tibble(mixFactor = rep(mix$FAC[[1]]$labels, times = length(source$source_names)),
#             source = rep(source$source_names, each = length(mix$FAC[[1]]$labels)),
#             mean = reshape2::melt(round(apply(jags.SRS3$BUGSoutput$sims.list$ilr.fac1, 
#                                               c(2, 3), mean), 3))$value,
#             sd = reshape2::melt(round(apply(jags.SRS3$BUGSoutput$sims.list$ilr.fac1, 
#                                             c(2, 3), sd), 3))$value,
#             `2.5%` = reshape2::melt(round(apply(jags.SRS3$BUGSoutput$sims.list$ilr.fac1, 
#                                                 c(2, 3), function(x) quantile(x, probs = c(0.025))), 3))$value,
#             `97.5%` = reshape2::melt(round(apply(jags.SRS3$BUGSoutput$sims.list$ilr.fac1, 
#                                                  c(2, 3), function(x) quantile(x, probs = c(0.975))), 3))$value)


#                      Mean    SD  2.5%    5%   25%   50%   75%   95% 97.5%
#p.dry19.Floc          0.104 0.085 0.004 0.007 0.038 0.084 0.148 0.270 0.320
#p.wet19.Floc          0.080 0.077 0.001 0.003 0.019 0.055 0.119 0.236 0.282
#p.dry19.Periphyton    0.081 0.065 0.003 0.006 0.031 0.066 0.114 0.211 0.247
#p.wet19.Periphyton    0.076 0.076 0.001 0.003 0.018 0.050 0.116 0.234 0.274
#p.dry19.Phytoplankton 0.542 0.088 0.377 0.403 0.480 0.539 0.600 0.690 0.720
#p.wet19.Phytoplankton 0.680 0.102 0.494 0.517 0.608 0.678 0.746 0.854 0.886
#p.dry19.Sawgrass      0.273 0.093 0.073 0.110 0.214 0.274 0.338 0.422 0.448
#p.wet19.Sawgrass      0.164 0.092 0.018 0.028 0.092 0.159 0.226 0.327 0.359

# combinedSRS3 <- combine_sources(jags.SRS3, mix, source, alpha.prior=1, 
#                                 groups=list(green=c('Phytoplankton','Periphyton' ), brown=c('Sawgrass','Floc')))


# get posterior medians for new source groupings
# apply(combinedSRS3$post, 2, median)
# summary_stat(combinedSRS3, meanSD=T, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
#              filename = "SRS3_combined_sumstats" )


#               Mean    SD  2.5%   25%   50%   75% 97.5%
#p.green.dry19 0.622 0.098 0.438 0.554 0.622 0.685 0.820
#p.brown.dry19 0.378 0.098 0.180 0.315 0.378 0.446 0.562
#p.green.wet19 0.756 0.103 0.553 0.686 0.757 0.829 0.948
#p.brown.wet19 0.244 0.103 0.052 0.171 0.243 0.314 0.447



```


#### Florida Bay ----
```{r}

TSFBmix<-SIa %>% filter(site == 'TS7'|site =='TS9'|site =='TS10'|site =='TS11', common_name!="Egyptian paspalidium",group=='Consumer')%>% rename('d13C'='md13C',"d15N"= "md15N","d34S"="md34S")


write.csv(TSFBmix,"TSFBmix.csv",row.names = F) 

mix <- load_mix_data(filename="TSFBmix.csv",
                     iso_names=c("d13C","d15N","d34S"),
                     factors=c('season','site'),
                     fac_random=c(F,F),
                     fac_nested=c(F,F),
                     cont_effects=NULL)

source <- load_source_data(filename="FCE_sources_TSFB.csv",
                           source_factors=NULL,
                           conc_dep=FALSE,
                           data_type="means",
                           mix)

discr <- load_discr_data(file("FCE_TEF_TSFB.csv"), mix)

plot_data(filename="TSFB_isospace_plot", plot_save_pdf=FALSE, plot_save_png=F, mix,source,discr)

model_filename <- "TSFB_mix.txt"
write_JAGS_model(model_filename, resid_err=F, process_err=T, mix, source)


#run a test model to make sure it works
jags.TSFB <- run_model(run="test", mix, source, discr, model_filename, 
                       alpha.prior = 1, resid_err=F, process_err=T)


jags.TSFB <- run_model(run="normal", mix, source, discr, model_filename,
                       alpha.prior = 1, resid_err=T, process_err=T)

output_jags.TSFB  <- list(summary_save = TRUE,
                          summary_name = "FCETSFB_sumstats",
                          sup_post = FALSE,
                          plot_post_save_pdf = F,
                          plot_post_name = "FCETSFB_plot",
                          sup_pairs = FALSE,
                          plot_pairs_save_pdf = F,
                          plot_pairs_name = "FCETSFB_pairs",
                          sup_xy = T,
                          plot_xy_save_pdf = F,
                          plot_xy_name = "FCETSFB_plot",
                          gelman = TRUE,
                          heidel = FALSE,
                          geweke = T,
                          diag_save = F,
                          diag_name = "FCETSFB_Diagnostic",
                          indiv_effect = FALSE,
                          plot_post_save_png = F,
                          plot_pairs_save_png = FALSE,
                          plot_xy_save_png = F)

output_JAGS(jags.TSFB , mix, source, output_jags.TSFB)



#                                   Mean    SD  2.5%    5%   25%   50%   75%   95% 97.5%
#p.dry19.TS10.Epiphytic microalgae 0.317 0.077 0.173 0.195 0.264 0.316 0.367 0.447 0.473
#p.dry19.TS10.Red Mangrove         0.033 0.021 0.004 0.006 0.017 0.029 0.045 0.074 0.083
#p.dry19.TS10.Seagrass             0.581 0.076 0.426 0.455 0.532 0.585 0.633 0.701 0.721
#p.dry19.TS10.SPOM                 0.069 0.055 0.002 0.005 0.026 0.055 0.099 0.180 0.209
#p.dry19.TS11.Epiphytic microalgae 0.691 0.104 0.490 0.515 0.617 0.694 0.767 0.857 0.882
#p.dry19.TS11.Red Mangrove         0.011 0.012 0.001 0.001 0.004 0.008 0.015 0.034 0.042
#p.dry19.TS11.Seagrass             0.252 0.098 0.078 0.097 0.180 0.247 0.318 0.421 0.455
#p.dry19.TS11.SPOM                 0.046 0.059 0.001 0.001 0.008 0.023 0.057 0.176 0.225
#p.dry19.TS7.Epiphytic microalgae  0.639 0.112 0.376 0.441 0.583 0.654 0.714 0.790 0.816
#p.dry19.TS7.Red Mangrove          0.132 0.068 0.003 0.010 0.085 0.133 0.178 0.245 0.262
#p.dry19.TS7.Seagrass              0.089 0.048 0.020 0.026 0.052 0.082 0.118 0.181 0.205
#p.dry19.TS7.SPOM                  0.139 0.150 0.001 0.003 0.026 0.088 0.202 0.460 0.524
#p.dry19.TS9.Epiphytic microalgae  0.839 0.085 0.640 0.676 0.790 0.853 0.903 0.953 0.966
#p.dry19.TS9.Red Mangrove          0.015 0.016 0.001 0.001 0.004 0.010 0.021 0.047 0.059
#p.dry19.TS9.Seagrass              0.095 0.060 0.015 0.021 0.050 0.082 0.126 0.214 0.242
#p.dry19.TS9.SPOM                  0.050 0.064 0.001 0.001 0.008 0.024 0.069 0.194 0.229
#p.wet19.TS10.Epiphytic microalgae 0.215 0.050 0.124 0.137 0.179 0.212 0.248 0.300 0.319
#p.wet19.TS10.Red Mangrove         0.065 0.034 0.003 0.009 0.042 0.063 0.087 0.122 0.136
#p.wet19.TS10.Seagrass             0.675 0.054 0.563 0.582 0.639 0.677 0.714 0.758 0.773
#p.wet19.TS10.SPOM                 0.046 0.045 0.001 0.003 0.013 0.031 0.063 0.142 0.171
#p.wet19.TS11.Epiphytic microalgae 0.593 0.082 0.438 0.462 0.537 0.591 0.648 0.734 0.756
#p.wet19.TS11.Red Mangrove         0.026 0.021 0.001 0.003 0.011 0.021 0.037 0.066 0.077
#p.wet19.TS11.Seagrass             0.351 0.086 0.177 0.207 0.295 0.352 0.410 0.488 0.516
#p.wet19.TS11.SPOM                 0.030 0.034 0.001 0.001 0.006 0.018 0.041 0.099 0.123
#p.wet19.TS7.Epiphytic microalgae  0.470 0.102 0.164 0.239 0.437 0.486 0.532 0.593 0.612
#p.wet19.TS7.Red Mangrove          0.295 0.111 0.002 0.006 0.274 0.325 0.363 0.413 0.429
#p.wet19.TS7.Seagrass              0.106 0.047 0.028 0.037 0.071 0.103 0.139 0.190 0.206
#p.wet19.TS7.SPOM                  0.129 0.205 0.001 0.002 0.014 0.043 0.121 0.678 0.761
#p.wet19.TS9.Epiphytic microalgae  0.781 0.084 0.604 0.631 0.726 0.787 0.841 0.907 0.929
#p.wet19.TS9.Red Mangrove          0.039 0.034 0.001 0.003 0.013 0.029 0.056 0.108 0.125
#p.wet19.TS9.Seagrass              0.142 0.073 0.031 0.040 0.087 0.132 0.186 0.280 0.310
#p.wet19.TS9.SPOM                  0.038 0.049 0.000 0.001 0.007 0.021 0.052 0.134 0.171

##combine posterior ground into brown/green

combinedTSFB <- combine_sources(jags.TSFB, mix, source, alpha.prior=1, 
                                groups=list(green=c('Epiphytic microalgae','SPOM' ), brown=c('Seagrass', 'Red Mangrove')))

# get posterior medians for new source groupings
apply(combinedTSFB$post, 2, median)
summary_stat(combinedTSFB, meanSD=T, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
             filename = "TSFB_combined_sumstats" )


#                    Mean    SD  2.5%   25%   50%   75% 97.5%
#p.green.TS10.dry19 0.386 0.077 0.244 0.333 0.381 0.436 0.546
#p.brown.TS10.dry19 0.614 0.077 0.454 0.564 0.619 0.667 0.756
#p.green.TS11.dry19 0.737 0.098 0.534 0.671 0.742 0.809 0.913
#p.brown.TS11.dry19 0.263 0.098 0.087 0.191 0.258 0.329 0.466
#p.green.TS7.dry19  0.779 0.086 0.613 0.721 0.776 0.837 0.948
#p.brown.TS7.dry19  0.221 0.086 0.052 0.163 0.224 0.279 0.387
#p.green.TS9.dry19  0.890 0.061 0.743 0.855 0.901 0.935 0.978
#p.brown.TS9.dry19  0.110 0.061 0.022 0.065 0.099 0.145 0.257
#p.green.TS10.wet19 0.260 0.057 0.160 0.218 0.257 0.296 0.381
#p.brown.TS10.wet19 0.740 0.057 0.619 0.704 0.743 0.782 0.840
#p.green.TS11.wet19 0.623 0.085 0.462 0.565 0.621 0.677 0.792
#p.brown.TS11.wet19 0.377 0.085 0.208 0.323 0.379 0.435 0.538
#p.green.TS7.wet19  0.598 0.131 0.434 0.516 0.566 0.625 0.951
#p.brown.TS7.wet19  0.402 0.131 0.049 0.375 0.434 0.484 0.566
#p.green.TS9.wet19  0.819 0.077 0.648 0.770 0.826 0.875 0.950
#p.brown.TS9.wet19  0.181 0.077 0.050 0.125 0.174 0.230 0.352


#######TS3#################


jags.TS3 <- run_model(run="test", mix, source, discr, model_filename, 
                      alpha.prior = 1, resid_err=F, process_err=T)


jags.TS3 <- run_model(run="normal", mix, source, discr, model_filename,
                      alpha.prior = 1, resid_err=F, process_err=T)

output_jags.TS3  <- list(summary_save = TRUE,
                         summary_name = "FCETS3_sumstats",
                         sup_post = FALSE,
                         plot_post_save_pdf = F,
                         plot_post_name = "FCETS3_plot",
                         sup_pairs = FALSE,
                         plot_pairs_save_pdf = F,
                         plot_pairs_name = "FCETS3_pairs",
                         sup_xy = T,
                         plot_xy_save_pdf = F,
                         plot_xy_name = "FCETS3_plot",
                         gelman = TRUE,
                         heidel = FALSE,
                         geweke = T,
                         diag_save = F,
                         diag_name = "FCETS3_Diagnostic",
                         indiv_effect = FALSE,
                         plot_post_save_png = F,
                         plot_pairs_save_png = FALSE,
                         plot_xy_save_png = F)

output_JAGS(jags.TS3 , mix, source, output_jags.TS3)



combinedTS3 <- combine_sources(jags.TS3, mix, source, alpha.prior=1, 
                               groups=list(green=c('Periphyton'), brown=c('Plant', 'Floc' )))

# get posterior medians for new source groupings
apply(combinedTS3$post, 2, median)
summary_stat(combinedTS3, meanSD=FALSE, quantiles=c(0.025, 0.25, 0.5, 0.75, 0.975), savetxt=T,
             filename = "TS3_combined_sumstats" )

```


#### Boxplots ----
```{r}
SRS_sumstats<-read.csv('RB10_mixout.csv')

# Set up plot aesthetics and label adjustments
theme_set(theme_bw())
theme_update(plot.title = element_text(size = 16, face = "bold"),
             axis.title = element_text(size = 14),
             axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
             strip.text = element_text(size = 14))

# Create the boxplot
transectCS <- ggplot(SIa1, aes(x = group, y = md34S, fill = group)) +
  geom_boxplot() +
  ylab(expression(paste(delta^{34}, "S (‰)"))) +
  xlab("Group") +
  ggtitle("Carbon and Sulfur Isotope Comparison") +
  scale_fill_viridis_d() +
  guides(fill = FALSE)

transectCS
# Adjust the facet labels to avoid overlap
transectCS <- transectCS + facet_wrap(~season, scales = "free_x", nrow = 2, labeller = label_wrap_gen(width = 20))

# Adjust the plot size for better visibility
ggsave("transectCS_boxplot.png", transectCS, width = 10, height = 8, dpi = 300)


transectCS

SRS_sumstats_gb<-read.csv('SRSMixout_gb.csv')
SRS_sumstats_gb$site<-fct_relevel(SRS_sumstats_gb$site, "SRS3","RB10", "SRS4","SRS6")

mixoutput_bxplt_gb_SRS<-ggplot(SRS_sumstats_gb,aes(x=season, fill=source, width=0.8))+
  geom_boxplot(aes(lower = X25., upper = X75., middle = X50., ymin = X2.50., ymax = X97.50.), stat="identity")+
  theme_bw()+scale_fill_manual(values=c("saddlebrown",'limegreen'))+ coord_cartesian(ylim = c( 0,1))+facet_grid(site~.)+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())+
  scale_y_continuous(expand = c(0.01, 0))+labs(y="Dietary contribution")+coord_flip()
mixoutput_bxplt_gb_SRS

TS_sumstats_gb<-read.csv('TS_sumstats_gb.csv')
TS_sumstats_gb$site<-fct_relevel(TS_sumstats_gb$site, "TS3","TS7","TS9","TS10","TS11")

mixoutput_bxplt_gb_TS<-ggplot(TS_sumstats_gb,aes(x=source, fill=source, width=0.8))+
  geom_boxplot(aes(lower = X25., upper = X75., middle = X50., ymin = X2.50., ymax = X97.50.), stat="identity")+
  theme_bw()+scale_fill_manual(values=c("saddlebrown",'limegreen'))+ coord_cartesian(ylim = c( 0,1))+facet_grid(site~season)+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())+
  scale_y_continuous(expand = c(0.01, 0))+labs(y="Dietary contribution")+coord_flip()


mixoutput_bxplt_gb_TS

#### James ----

srs3_spp_boxplot <-ggplot(df_srs3,aes(x=source, fill=source, width=0.8)) +
  geom_boxplot(aes(lower = X25., upper = X75., middle = X50., ymin = X2.50., ymax = X97.50.), stat="identity")+
  geom_point(aes(shape = as.factor(code))) +
  geom_jitter(position = "dodge") +
  theme_bw()+scale_fill_manual(values=c("saddlebrown",'limegreen'))+ coord_cartesian(ylim = c( 0,1))+facet_grid(site~season)+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())+
  scale_y_continuous(expand = c(0.01, 0))+labs(y="Dietary contribution")+coord_flip()

```


